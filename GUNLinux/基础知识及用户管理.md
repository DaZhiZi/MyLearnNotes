# 基础知识及用户管理 



## 用户与终端的常用命令

### **查看用户:**

```bash
$ who am i
或者
$ who mom likes
```

输出的第一列表示打开当前伪终端的用户的用户名（要查看当前登录用户的用户名，去掉空格直接使用 `whoami` 即可），第二列的 `pts/0` 中 `pts` 表示伪终端，所谓伪是相对于 `/dev/tty` 设备而言的，还记得上一节讲终端时的那七个使用 `[Ctrl]`+`[Alt]`+`[F1]～[F7]` 进行切换的 `/dev/tty` 设备么,这是“真终端”，伪终端就是当你在图形用户界面使用 `/dev/tty7` 时每打开一个终端就会产生一个伪终端， `pts/0` 后面那个数字就表示打开的伪终端序号，你可以尝试再打开一个终端，然后在里面输入 `who am i` ，看第二列是不是就变成 `pts/1` 了，第三列则表示当前伪终端的启动时间。

`who` 命令其它常用参数

| 参数 | 说明                       |
| ---- | -------------------------- |
| `-a` | 打印能打印的全部           |
| `-d` | 打印死掉的进程             |
| `-m` | 同`am i`,`mom likes`       |
| `-q` | 打印当前登录用户数及用户名 |
| `-u` | 打印当前登录用户登录信息   |
| `-r` | 打印运行等级               |

#### **用户和用户组:**

> 在 Linux 里面每个用户都有一个归属（用户组），用户组简单地理解就是一组用户的集合，它们共享一些资源和权限，同时拥有私有资源，就跟家的形式差不多，你的兄弟姐妹（不同的用户）属于同一个家（用户组），你们可以共同拥有这个家（共享资源），爸妈对待你们都一样（共享权限），你偶尔写写日记，其他人未经允许不能查看（私有资源和权限）。当然一个用户是可以属于多个用户组的，正如你既属于家庭，又属于学校或公司。

权限问题略过不表,需要时加上`sudo `

- **添加账户:**

`sudo adduser xxx`,用此命令实质上是调用了一个脚本，会有和用户交互的界面，根据选项创建.还有一个命令是`sudo useradd xxx`这种方法创建的用户是三无用户,一无Home Directory，二无密码，三无系统Shell。

关于两者的区别:

useradd 只创建用户，创建完了用 passwd lilei 去设置新用户的密码。adduser 会创建用户，创建目录，创建密码（提示你设置），做这一系列的操作。其实 useradd、userdel 这类操作更像是一种命令，执行完了就返回。而 adduser 更像是一种程序，需要你输入、确定等一系列操作。

> `adduser`的使用详解:
> 在使用adduser命令的时候，系统会添加这个用户名，并且还会自动地创建与这个用户名名字一样的用户组作为这个用户的初始用户组。此外，还会自动地在/home目录下面创建一个与用户同名的目录，接着执行"cp /etc/skel  /home/用户名"的操作，实现新增用户的主目录的初始化。
> 用adduser这个命令创建的账号是系统账号，可以用来登录到我们的ubuntu系统。
> 二.useradd的使用详解
> useradd有大量的参数供我们进行个性化设置，但是，也有比较多的默认设置是我们不知道的，所以，在进行这个参数选择的时候还是需要谨慎和细心，不然的话可能会得到跟我们预想中不一样的结果。useradd的参数如下：
> ​        -c 备注 加上备注。并会将此备注文字加在/etc/passwd中的第5项字段中
> ​        -d 用户主文件夹。指定用户登录所进入的目录，并赋予用户对该目录的的完全控制权
> ​        -e 有效期限。指定帐号的有效期限。格式为YYYY-MM-DD，将存储在/etc/shadow
> ​        -f 缓冲天数。限定密码过期后多少天，将该用户帐号停用
> ​        -g 主要组。设置用户所属的主要组
> ​        -G 次要组。设置用户所属的次要组，可设置多组
> ​        -M 强制不创建用户主文件夹
> ​       -m 强制建立用户主文件夹，并将/etc/skel/当中的文件复制到用户的根目录下
> ​        -p 密码。输入该帐号的密码
> ​        -s shell。用户登录所使用的shell
> ​        -u uid。指定帐号的标志符user id，简称uid
> useradd这个命令创建的是普通账号，并不能用来登录系统。
> 于是我得出了一个结论：当使用参数"-m"的时候，系统会自动地在/home目录下建立一个与新建用户同名的用户主文件夹；如果不使用"-m"的话，那么就默认是使用“-M”参数，不创建主文件夹，即使你使用了"-d"这个参数。所以，"-d"这个参数是跟"-m"一起使用的，让用户自己选择主文件夹的路径。

当使用`useradd`创建账户时，可以通过一以下方法来加到sudo组中:

```shell
useradd -m steven   //steven 是我的用户名
passwd steven    //为刚创建的用户设置密码
usermod -a -G sudo steven    //注意改成你自己的用户名
```

这样可以使新建的用户到sudo组.

- 查看用户所属组:`cat /etc/group | sort`
  这里 `cat` 命令用于读取指定文件的内容并打印到终端输出，后面会详细讲它的使用。 `| sort` 表示将读取的文本进行一个字典排序再输出，然后你将看到如下一堆输出，你可以在最下面看到 的用户组信息：
  ![](/home/riba2534/Documents/MyGitProject/FindOfferNote/GUNLinux/picture/%E7%94%A8%E6%88%B7%E7%BB%84.png)

`etc/group` 文件格式说明
/etc/group 的内容包括用户组（Group）、用户组口令、GID 及该用户组所包含的用户（User），每个用户组一条记录。格式如下：

> group_name:password:GID:user_list

你看到上面的 password 字段为一个 `x` 并不是说密码就是它，只是表示密码不可见而已。

#### 删除用户

```shell
sudo deluser lilei --remove-home
```

使用以上命令删除即可

## Linux 文件权限

文件权限就是文件的访问控制权限，即哪些用户和组群可以访问文件以及可以执行什么样的操作。

Unix/Linux系统是一个典型的多用户系统，不同的用户处于不同的地位，对文件和目录有不同的访问权限。为了保护系统的安全性，Unix/Linux系统除了对用户权限作了严格的界定外，还在用户身份认证、访问控制、传输安全、文件读写权限等方面作了周密的控制。

在 Unix/Linux中的每一个文件或目录都包含有访问权限，这些访问权限决定了谁能访问和如何访问这些文件和目录。

### 查看文件权限

我们之前已经很多次用到 `ls` 命令了，如你所见，我们用它来列出并显示当前目录下的文件，当然这是在不带任何参数的情况下，它能做的当然不止这么多，现在我们就要用它来查看文件权限。

使用较长格式列出文件：

```
$ ls -l
```

![img](https://doc.shiyanlou.com/document-uid735639labid3timestamp1531731455816.png/wm)

你可能除了知道最后面那一项是文件名之外，其它项就不太清楚了，那么到底是什么意思呢：

![img](https://doc.shiyanlou.com/linux_base/3-9.png/wm)

可能你还是不太明白，比如第一项文件类型和权限那一堆东西具体指什么，链接又是什么，何为最后修改时间，下面一一道来：

![img](https://doc.shiyanlou.com/linux_base/3-10.png/wm)

- 文件类型

关于文件类型，这里有一点你必需时刻牢记 **Linux 里面一切皆文件**，正因为这一点才有了设备文件（ `/dev` 目录下有各种设备文件，大都跟具体的硬件设备相关）这一说。 `socket`：网络套接字，具体是什么，感兴趣的用户可以自己去了解或期待实验楼的后续相关课程。`pipe` 管道，这个东西很重要，我们以后将会讨论到，这里你先知道有它的存在即可。`软链接文件`：链接文件是分为两种的，另一种当然是“硬链接”（硬链接不常用，具体内容不作为本课程讨论重点，而软链接等同于 Windows 上的快捷方式,你记住这一点就够了）。

- 文件权限

读权限，表示你可以使用 `cat <file name>` 之类的命令来读取某个文件的内容；写权限，表示你可以编辑和修改某个文件； 执行权限，通常指可以运行的二进制程序文件或者脚本文件，如同 Windows 上的 `exe` 后缀的文件，不过 Linux 上不是通过文件后缀名来区分文件的类型。你需要注意的一点是，**一个目录同时具有读权限和执行权限才可以打开并查看内部文件，而一个目录要有写权限才允许在其中创建其它文件**，这是因为目录文件实际保存着该目录里面的文件的列表等信息。

所有者权限，这一点相信你应该明白了，至于所属用户组权限，是指你所在的用户组中的所有其它用户对于该文件的权限，比如，你有一个 iPad，那么这个用户组权限就决定了你的兄弟姐妹有没有权限使用它破坏它和占有它。

- 链接数

> 链接到该文件所在的 inode 结点的文件名数目（关于这个概念涉及到 Linux 文件系统的相关概念知识，不在本课程的讨论范围，感兴趣的用户可以自己去了解）。

- 文件大小

> 以 inode 结点大小为单位来表示的文件大小，你可以给 ls 加上 `-lh` 参数来更直观的查看文件的大小。

明白了文件权限的一些概念，我们顺带补充一下关于 `ls` 命令的一些其它常用的用法：

- 显示除了 `.`（当前目录）和 `..`（上一级目录）之外的所有文件，包括隐藏文件（Linux 下以 `.` 开头的文件为隐藏文件）。

```
$ ls -A
```

![3-2.3-4](https://doc.shiyanlou.com/document-uid735639labid3timestamp1531731522478.png/wm)

当然，你可以同时使用 `-A` 和 `-l` 参数：

```
$ ls -Al
```

查看某一个目录的完整属性，而不是显示目录里面的文件属性：

```
$ ls -dl <目录名>
```

- 显示所有文件大小，并以普通人类能看懂的方式呈现：

```
$ ls -AsSh
```

其中小 s 为显示文件大小，大 S 为按文件大小排序，若需要知道如何按其它方式排序，请使用“man”命令查询。

### 变更文件所有者

> 若前面已经执行删除lilei用户的命令，这里重新创建一下。

假设目前是 lilei 用户登录，新建一个文件，命名为 “ iphone6 ”：

```
$ cd /home/lilei
$ touch iphone6
```

可见文件所有者是 lilei ：

![3-3.2-1](https://doc.shiyanlou.com/document-uid600404labid3timestamp1532311534658.png/wm)

现在，换回到 shiyanlou 用户身份，使用以下命令变更文件所有者为 shiyanlou ：

```
$ cd /home/lilei
$ ls iphone6
$ sudo chown shiyanlou iphone6
```

现在查看，发现 文件所有者成功修改为 shiyanlou ：

![3-3.2-2](https://doc.shiyanlou.com/document-uid735639labid3timestamp1531731650844.png/wm)

### 修改文件权限

如果你有一个自己的文件不想被其他用户读、写、执行，那么就需要对文件的权限做修改，这里有两种方式：

- 方式一：二进制数字表示

![img](https://doc.shiyanlou.com/linux_base/3-14.png/wm)

每个文件的三组权限（拥有者，所属用户组，其他用户，**记住这个顺序是一定的**）对应一个 " rwx "，也就是一个 “ 7 ” ，所以如果我要将文件“ iphone6 ”的权限改为只有我自己可以用那么就这样：

为了演示，我先在文件里加点内容：

```
$ echo "echo \"hello shiyanlou\"" > iphone6
```

然后修改权限：

```
$ chmod 600 iphone6
```

现在，其他用户已经不能读这个“ iphone6 ”文件了：

![3-3.3-1](https://doc.shiyanlou.com/document-uid735639labid3timestamp1531731724644.png/wm)

- 方式二：加减赋值操作

完成上述相同的效果，你可以：

```
$ chmod go-rw iphone6
```

![3-3.3-2](https://doc.shiyanlou.com/document-uid735639labid3timestamp1531731758217.png/wm)

`g`、`o` 还有 `u` 分别表示 group、others 和 user，`+` 和 `-` 分别表示增加和去掉相应的权限。

